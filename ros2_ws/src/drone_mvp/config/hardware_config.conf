# KAERTEI 2025 FAIO - Hardware Configuration
# ===========================================
# [MISSION]
# Mission execution parameters
debug_mode = true
checkpoint_timeout = 300
indoor_altitude = 0.6
outdoor_altitude = 3.0
mission_timeout = 900
max_velocity = 2.0
search_timeout = 60
alignment_tolerance = 20
pickup_descent_speed = 0.3
pickup_ascent_speed = 0.3
turn_direction = right
# Edit file ini sesuai dengan setup hardware Anda

# ===========================================
# 1. PX4 FLIGHT CONTROLLER CONNECTION
# ===========================================

[flight_controller]
# Port koneksi ke Pixhawk PX4
# Ganti sesuai port yang terdeteksi di sistem Anda
# Cek dengan: ls /dev/tty* | grep -E "(USB|ACM)"
connection_port = "/dev/ttyUSB0"
# connection_port = "/dev/ttyACM0"  # Alternative untuk beberapa Pixhawk

# Baud rate komunikasi MAVLink
# 57600 = standard, 115200 = faster (jika didukung)
baud_rate = 57600
# baud_rate = 115200  # Uncomment jika ingin speed lebih tinggi

# Timeout koneksi (detik)
connection_timeout = 10

# ===========================================
# 2. CAMERA CONFIGURATION
# ===========================================

[cameras]
# Index kamera USB (mulai dari 0)
# Cek dengan: v4l2-ctl --list-devices
front_camera_index = 0   # Kamera depan - biasanya /dev/video0
back_camera_index = 2    # Kamera belakang - biasanya /dev/video2  
top_camera_index = 4     # Kamera atas - biasanya /dev/video4

# Resolusi kamera (width x height)
camera_width = 640
camera_height = 480

# Frame rate (FPS)
camera_fps = 30

# Kalibrasi offset kamera (pixel) - sesuaikan jika mount tidak center
front_camera_offset_x = 0    # Positive = shift right
front_camera_offset_y = 0    # Positive = shift down
back_camera_offset_x = 0
back_camera_offset_y = 0
top_camera_offset_x = 0
top_camera_offset_y = 0

# ===========================================
# 3. GPIO PIN ASSIGNMENTS (RASPBERRY PI)
# ===========================================

[gpio_pins]
# Electromagnet control pins (BCM numbering)
# Cek pinout: https://pinout.xyz/
front_magnet_pin = 18       # GPIO 18 (Pin 12) - Front electromagnet relay
back_magnet_pin = 19        # GPIO 19 (Pin 35) - Back electromagnet relay

# Optional: LED status indicators
status_led_pin = 21         # GPIO 21 (Pin 40) - Status LED
error_led_pin = 20          # GPIO 20 (Pin 38) - Error LED

# Optional: Emergency stop button
emergency_stop_pin = 16     # GPIO 16 (Pin 36) - Emergency stop button (pull-up)

# Relay control logic (True = active HIGH, False = active LOW)
relay_active_high = true    # Set false jika relay aktif dengan LOW signal

# ===========================================
# 4. SENSOR CONFIGURATION
# ===========================================

[sensors]
# ToF Distance Sensors (I2C addresses)
# Default VL53L0X addresses: 0x29
# Jika pakai multiple sensor, perlu address remap
tof_left_address = "0x30"      # Left ToF sensor I2C address
tof_right_address = "0x31"     # Right ToF sensor I2C address  
tof_front_address = "0x32"     # Front ToF sensor I2C address

# ToF measurement range (meters)
tof_max_range = 4.0
tof_detection_threshold = 1.5   # Obstacle detection distance

# I2C bus number (biasanya 1 untuk Raspberry Pi)
i2c_bus = 1

# ===========================================
# 5. FLIGHT PARAMETERS
# ===========================================

[flight]
# Altitude settings (meters)
takeoff_altitude = 1.5          # Altitude for takeoff
indoor_cruise_altitude = 1.5    # Indoor flying altitude
outdoor_cruise_altitude = 3.0   # Outdoor flying altitude
landing_descent_rate = 0.3      # Landing descent speed (m/s)

# Velocity limits (m/s)
max_horizontal_velocity = 2.0   # Maximum forward/sideways speed
max_vertical_velocity = 1.0     # Maximum up/down speed
max_yaw_rate = 45.0            # Maximum rotation speed (degrees/s)

# Safety limits
max_altitude_limit = 10.0       # Hard altitude limit
geofence_radius = 100.0         # Maximum distance from home (meters)
battery_failsafe_voltage = 14.4 # Low battery voltage (V)

# ===========================================
# 6. COMPUTER VISION SETTINGS
# ===========================================

[vision]
# Object detection parameters
detection_confidence_threshold = 0.5    # YOLOv8 confidence threshold
alignment_tolerance_pixels = 30         # Alignment precision (pixels)

# Color detection ranges (HSV)
# Red objects (default)
red_lower_hue = 0
red_upper_hue = 10
red_lower_saturation = 50
red_upper_saturation = 255
red_lower_value = 50
red_upper_value = 255

# Blue objects (alternative)
blue_lower_hue = 100
blue_upper_hue = 130
blue_lower_saturation = 50
blue_upper_saturation = 255
blue_lower_value = 50
blue_upper_value = 255

# Minimum object size (pixels) untuk valid detection
min_object_area = 1000

# ===========================================
# 7. MISSION WAYPOINTS (GPS COORDINATES)
# ===========================================

[waypoints]
# Home position (set saat pertama kali armed)
# Akan otomatis terisi saat takeoff pertama

# Outdoor pickup location
# PENTING: Sesuaikan dengan lokasi kompetisi!
outdoor_pickup_latitude = -6.365000    # Degrees
outdoor_pickup_longitude = 106.825000  # Degrees
outdoor_pickup_altitude = 30.0         # Meters above home

# Outdoor drop location  
outdoor_drop_latitude = -6.364500      # Degrees
outdoor_drop_longitude = 106.825500    # Degrees
outdoor_drop_altitude = 30.0           # Meters above home

# GPS accuracy requirements
gps_accuracy_threshold = 2.0            # Minimum GPS accuracy (meters)
waypoint_reached_threshold = 3.0        # Distance to consider waypoint reached

# ===========================================
# 8. TIMING PARAMETERS
# ===========================================

[timing]
# Checkpoint timeouts (seconds)
checkpoint_timeout = 120               # Max time per checkpoint
mission_total_timeout = 900            # 15 minutes total mission time

# Hardware operation delays (seconds)
magnet_activation_delay = 1.0          # Time to wait after magnet on
magnet_deactivation_delay = 0.5        # Time to wait after magnet off
camera_startup_delay = 2.0             # Camera initialization time
descent_pickup_time = 3.0              # Time for pickup descent
ascent_after_pickup_time = 3.0         # Time for ascent after pickup

# Detection timeouts
object_detection_timeout = 30.0        # Max time to search for object
alignment_timeout = 15.0               # Max time to align with object
dropzone_search_timeout = 45.0         # Max time to find dropzone

# ===========================================
# 9. COMMUNICATION SETTINGS
# ===========================================

[communication]
# ROS 2 topic update rates (Hz)
mission_status_rate = 2.0              # Mission status publishing rate
sensor_update_rate = 10.0              # Sensor data rate
camera_frame_rate = 30.0               # Camera image publishing rate
flight_command_rate = 20.0             # Flight command rate

# QGroundControl connection (optional monitoring)
qgc_udp_port = 14550                   # QGC UDP port
qgc_enabled = true                     # Enable QGC telemetry

# ===========================================
# 10. DEBUG & LOGGING
# ===========================================

[debug]
# Log levels: DEBUG, INFO, WARN, ERROR
log_level = "INFO"
# log_level = "DEBUG"  # Uncomment untuk detailed debugging

# Enable/disable debug features
enable_checkpoint_logging = true       # Log setiap checkpoint
enable_sensor_logging = false          # Log semua sensor data (verbose)
enable_camera_recording = false        # Record camera feeds to file
enable_flight_data_logging = true      # Log flight telemetry

# File paths untuk logs
log_directory = "/tmp/kaertei_logs"
camera_recording_path = "/tmp/camera_recordings"

# ===========================================
# CATATAN PENTING UNTUK SETUP:
# ===========================================

# 1. KONEKSI PX4:
#    - Cek port dengan: ls /dev/tty* | grep -E "(USB|ACM)"
#    - Test koneksi dengan: sudo chmod 666 /dev/ttyUSB0
#    - Pastikan user masuk grup dialout: sudo usermod -a -G dialout $USER

# 2. KAMERA:
#    - List device: v4l2-ctl --list-devices
#    - Test kamera: cheese atau vlc v4l2:///dev/video0
#    - Pastikan resolusi didukung kamera

# 3. GPIO (RASPBERRY PI):
#    - Install: pip3 install RPi.GPIO
#    - Enable I2C: sudo raspi-config -> Interface -> I2C -> Enable
#    - Check I2C devices: i2cdetect -y 1

# 4. PERMISSIONS:
#    - sudo usermod -a -G dialout,video,i2c,gpio $USER
#    - Logout dan login ulang setelah menambah grup

# 5. TESTING:
#    - Test magnet: python3 -c "import RPi.GPIO as GPIO; GPIO.setmode(GPIO.BCM); GPIO.setup(18, GPIO.OUT); GPIO.output(18, GPIO.HIGH)"
#    - Test kamera: ros2 run drone_mvp camera_control_node.py
#    - Test PX4: ros2 run drone_mvp checkpoint_mission_node.py

# ===========================================
# GPS WAYPOINTS (UPDATE FOR YOUR VENUE!)
# ===========================================

[GPS_WAYPOINTS]
# Waypoint 1: Pickup outdoor item
waypoint_1_lat = -6.365000
waypoint_1_lon = 106.825000
waypoint_1_alt = 30.0

# Waypoint 2: Drop outdoor item
waypoint_2_lat = -6.364500
waypoint_2_lon = 106.825500
waypoint_2_alt = 30.0

# Waypoint 3: Final landing
waypoint_3_lat = -6.364000
waypoint_3_lon = 106.826000
waypoint_3_alt = 30.0

# Home position reference
home_lat = -6.365500
home_lon = 106.824500
home_alt = 0.0
